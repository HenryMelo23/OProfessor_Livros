<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Cat√°logo de Livros</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        @media (min-width: 768px) {

            p {
                white-space: pre-wrap;
                text-align: justify;
            }
            .sidebar {
                position: fixed;
                top: 0;
                left: 0;
                height: 100%;
                width: 180px;
                background-color: #343a40;
                padding-top: 60px;
                display: flex;
                flex-direction: column;
                align-items: center;
                z-index: 1000;
            }

            .sidebar a {
                padding: 15px 10px;
                text-decoration: none;
                color: white;
                width: 100%;
                text-align: center;
                transition: background 0.3s;
                font-weight: bold;
            }

            .sidebar a:hover {
                background-color: #495057;
            }

            body {
                margin-left: 180px;
            }
        }
        .favorito-icone {
            position: absolute;
            top: 10px;
            right: 10px;
            background: transparent;
            border: none;
            font-size: 24px;
            cursor: pointer;
            outline: none;
            padding: 0;
            line-height: 1;
            width: auto;
            height: auto;
            display: inline-block;
        }

        .favorito-icone:focus {
            outline: none;
            box-shadow: none;
        }

        .favorito-icone:hover {
            background: none;
        }
        #resultado {
            position: relative; /* necess√°rio para posicionar o bot√£o dentro dele */
        }

        #contador-livros {
            position: fixed;
            top: 15px;
            right: 20px;
            color: white;
            font-weight: bold;
            font-size: 16px;
            z-index: 1001;
        }

        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            margin: 0;
            text-align: center;

            background-image: url('https://raw.githubusercontent.com/HenryMelo23/OProfessor_Livros/Professor-1.1.5/imagens/planof.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            min-height: 100vh;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 20px;
            
        }
        h1 {
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            }

        input, button {
            font-size: 16px;
            padding: 12px;
            margin: 5px 0;
            width: 100%;
            max-width: 400px;
        }

        button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }

        #resultado {
            margin-top: 30px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .disponivel {
            color: green;
            font-weight: bold;
            margin-top: 15px;
        }

        .indisponivel {
            color: red;
            font-weight: bold;
            margin-top: 15px;
        }

        img {
            width: 100%;
            max-width: 200px;
            height: auto;
            margin: 20px 0;
            border-radius: 8px;
        }

        #whatsapp {
            margin-top: 25px;
        }

        #whatsapp a {
            background-color: #25D366;
            color: white;
            padding: 14px 20px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            display: inline-block;
            transition: background-color 0.3s;
        }

        #whatsapp a:hover {
            background-color: #1ebe5b;
        }

        @media (max-width: 500px) {
            h1 {
                font-size: 20px;
            }

            input, button {
                font-size: 15px;
                padding: 10px;
            }

            #resultado {
                padding: 15px;
            }
        }
        /* NAVBAR MOBILE */
        .mobile-navbar {
        display: none;
        }

        @media (max-width: 768px) {
        .sidebar {
            display: none !important;
        }

        .mobile-navbar {
            display: flex;
            justify-content: space-around;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background-color: #222;
            color: white;
            z-index: 9999;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .mobile-navbar a {
            color: white;
            text-decoration: none;
            font-size: 14px;
            font-weight: bold;
        }

        body {
            padding-top: 70px; /* espa√ßo para a navbar n√£o cobrir o conte√∫do */
        }
        }
    </style>
</head>
<body>
    <h1> üìöO Professorüë¥</h1>
    <input type="text" id="titulo" placeholder="Digite o t√≠tulo do livro">
    <button onclick="buscarLivro()">Buscar</button>
    <div id="contador-livros">Temos dispon√≠veis: ...</div>

    <div id="resultado"></div>

    <div class="sidebar">
        <a href="estante.html">Estante</a>
        <a href="#">Contato</a>
        <a href="#">Informa√ß√µes</a>
        <a href="#" onclick="mostrarFavoritos()">Favoritos ‚ù§Ô∏è</a>
        <a href="https://www.instagram.com/seuluiz_livros/" target="_blank">Instagram</a>
    </div>
    <nav class="mobile-navbar">
        <a href="index.html">In√≠cio</a>
        <a href="estante.html">Estante</a>
        <a href="https://wa.me/5561995948789" target="_blank">Contato</a>
        
        <a href="https://www.instagram.com/seuluiz_livros/" target="_blank">Instagram</a>
        <a href="#">Informa√ß√µes</a>
      </nav>

    <script>
        async function buscarLivro() {
        const termo = document.getElementById("titulo").value.trim();
        const resultado = document.getElementById("resultado");

        if (!termo) {
            resultado.innerHTML = "<p>Digite o t√≠tulo ou o nome do autor.</p>";
            return;
        }

        try {
            const resposta = await fetch(`https://oprofessor-livros.onrender.com/buscar?titulo=${encodeURIComponent(termo)}`);
            const dados = await resposta.json();

            if (resposta.ok && dados.tipo === "livro") {
                const cor = dados.disponivel ? 'disponivel' : 'indisponivel';
                const imagem = `https://raw.githubusercontent.com/HenryMelo23/OProfessor_Livros/Professor-1.1.5/imagens/${encodeURIComponent(dados.titulo)}.png`;
                const mensagemWhatsApp = encodeURIComponent(`Ol√°! Tenho interesse no livro "${dados.titulo}". Poderia me dar mais informa√ß√µes?`);

                const livroObj = {
                    titulo: dados.titulo,
                    autor: dados.autor,
                    sinopse: dados.sinopse,
                    disponivel: dados.disponivel
                };

                resultado.innerHTML = `
                    <img src="${imagem}" alt="${dados.titulo}">
                    <h2>${dados.titulo}</h2>
                    <p><strong>Autor:</strong> ${dados.autor}</p>
                    <p><strong>Sinopse:</strong> ${dados.sinopse || 'Sinopse n√£o dispon√≠vel.'}</p>
                    <p class="${cor}">${dados.disponivel ? 'Dispon√≠vel' : 'Indispon√≠vel'}</p>

                    <button id="favoritar-btn"
                        class="favorito-icone"
                        data-titulo="${dados.titulo}"
                        data-autor="${dados.autor}"
                        data-sinopse="${dados.sinopse}"
                        data-disponivel="${dados.disponivel}">
                        ü§ç
                    </button>


                    <div id="whatsapp">
                        <a href="https://wa.me/5561995948789?text=${mensagemWhatsApp}" target="_blank">
                            Entrar em contato via WhatsApp
                        </a>
                    </div>
                `;
                // Checar se j√° est√° favoritado ao carregar
                const favoritos = JSON.parse(localStorage.getItem("favoritos")) || [];
                const jaFavorito = favoritos.some(l => l.titulo === dados.titulo);
                document.getElementById("favoritar-btn").innerText = jaFavorito ? "‚ù§Ô∏è" : "ü§ç";

                document.getElementById("favoritar-btn").addEventListener("click", function () {
                    const btn = this;
                    const livro = {
                        titulo: btn.dataset.titulo,
                        autor: btn.dataset.autor,
                        sinopse: btn.dataset.sinopse,
                        disponivel: btn.dataset.disponivel === "true"
                    };

                    let favoritos = JSON.parse(localStorage.getItem("favoritos")) || [];
                    const index = favoritos.findIndex(l => l.titulo === livro.titulo);

                    if (index === -1) {
                        favoritos.push(livro);
                        btn.innerText = "‚ù§Ô∏è";
                    } else {
                        favoritos.splice(index, 1);
                        btn.innerText = "ü§ç";
                    }

                    localStorage.setItem("favoritos", JSON.stringify(favoritos));
                });

            } else if (resposta.ok && dados.tipo === "autor") {
                resultado.innerHTML = `<h2>Livros de ${dados.autor}</h2>` + dados.livros.map(livro => {
                    const imagem = `https://raw.githubusercontent.com/HenryMelo23/OProfessor_Livros/Professor-1.1.5/imagens/${encodeURIComponent(livro.titulo)}.png`;
                    const cor = livro.disponivel ? 'disponivel' : 'indisponivel';
                    const mensagemWhatsApp = encodeURIComponent(`Ol√°! Tenho interesse no livro "${livro.titulo}". Poderia me dar mais informa√ß√µes?`);

                    return `
                        <div style="margin-bottom: 30px;">
                            <img src="${imagem}" alt="${livro.titulo}">
                            <h3>${livro.titulo}</h3>
                            <p><strong>Autor:</strong> ${livro.autor}</p>
                            <p class="${cor}">${livro.disponivel ? 'Dispon√≠vel' : 'Indispon√≠vel'}</p>
                            <div>
                                <a href="https://wa.me/5561995948789?text=${mensagemWhatsApp}" target="_blank" style="background-color:#25D366;padding:10px 15px;border-radius:8px;color:white;text-decoration:none;font-weight:bold;">
                                    WhatsApp
                                </a>
                            </div>
                        </div>
                    `;
                }).join('');
            } else {
                resultado.innerHTML = "<p class='indisponivel'>Nenhum resultado encontrado.</p>";
            }
        } catch (erro) {
            console.error("Erro ao buscar:", erro);
            resultado.innerHTML = "<p class='indisponivel'>Erro ao buscar o livro ou autor.</p>";
        }
    }

        async function contarLivrosDisponiveis() {
            try {
                const resposta = await fetch("https://oprofessor-livros.onrender.com/contar");
                const dados = await resposta.json();
                document.getElementById("contador-livros").innerText = `Temos dispon√≠veis: ${dados.total_disponiveis}`;
            } catch (erro) {
                console.error("Erro ao contar livros:", erro);
                document.getElementById("contador-livros").innerText = `Erro ao carregar contador.`;
            }
        }

        // Quando a p√°gina carregar
        window.onload = function () {
            contarLivrosDisponiveis();

            // Se tiver ?titulo= na URL, j√° busca direto
            const params = new URLSearchParams(window.location.search);
            const titulo = params.get("titulo");
            if (titulo) {
                document.getElementById("titulo").value = titulo;
                buscarLivro();
            }
        };

        // Detecta ENTER no campo de texto
        document.getElementById("titulo").addEventListener("keydown", function (event) {
            if (event.key === "Enter") {
                event.preventDefault();
                buscarLivro();
            }
        });

        function adicionarAosFavoritos(livro) {
            let favoritos = JSON.parse(localStorage.getItem("favoritos")) || [];
            const existe = favoritos.some(l => l.titulo === livro.titulo);
            if (!existe) {
                favoritos.push(livro);
                localStorage.setItem("favoritos", JSON.stringify(favoritos));
                alert("Livro adicionado aos favoritos!");
            } else {
                alert("Este livro j√° est√° nos favoritos.");
            }
        }

        function mostrarFavoritos() {
            const favoritos = JSON.parse(localStorage.getItem("favoritos")) || [];
            const resultado = document.getElementById("resultado");

            if (favoritos.length === 0) {
                resultado.innerHTML = "<p style='color:white;'>Voc√™ ainda n√£o favoritou nenhum livro.</p>";
                return;
            }

            resultado.style.backgroundColor = "transparent";
            resultado.style.boxShadow = "none";
            resultado.style.padding = "0";
            resultado.innerHTML = `
                <h2 style="color:white; margin-bottom: 20px;">üìö Seus Favoritos</h2>
                <div id="grid-favoritos" class="livros-grid"></div>
            `;

            const grid = document.getElementById("grid-favoritos");

            // Aplicar estilo diretamente no elemento
            Object.assign(grid.style, {
                display: "grid",
                gridTemplateColumns: "repeat(auto-fit, minmax(120px, 1fr))",
                gap: "20px",
                padding: "20px",
                borderRadius: "15px",
                backgroundColor: "rgba(0, 0, 0, 0.5)", // cinza transl√∫cido
                boxShadow: "0 4px 10px rgba(0,0,0,0.8)"
            });

            favoritos.forEach(livro => {
                const imagem = `https://raw.githubusercontent.com/HenryMelo23/OProfessor_Livros/Professor-1.1.5/imagens/${encodeURIComponent(livro.titulo)}.png`;
                const link = `index.html?titulo=${encodeURIComponent(livro.titulo)}`;

                const card = document.createElement("div");
                card.className = "livro";
                card.style.textAlign = "center";
                card.style.textDecoration = "none";

                card.innerHTML = `
                    <img src="${imagem}" alt="${livro.titulo}" style="width:100%; max-width:120px; border-radius:8px; box-shadow: 0 2px 6px rgba(0,0,0,0.2);">
                    <div style="color:white; font-size:14px; margin-top:6px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;" title="${livro.titulo}">
                        ${livro.titulo}
                    </div>
                    <button onclick="removerFavorito('${livro.titulo}')" style="margin-top:5px; padding:4px 10px; background:#dc3545; color:white; border:none; border-radius:5px; cursor:pointer; font-size:12px;">
                        Remover
                    </button>
                `;
            

                grid.appendChild(card);
            });
        }
        function removerFavorito(titulo) {
            let favoritos = JSON.parse(localStorage.getItem("favoritos")) || [];
            favoritos = favoritos.filter(livro => livro.titulo !== titulo);
            localStorage.setItem("favoritos", JSON.stringify(favoritos));
            mostrarFavoritos(); // atualiza a grade
        }

    </script>
</body>
</html>
